# SmartLightBLE

### 功能简述

该课题目的式为了实现一个家居智能灯光场景，课题的早期设计已经再尝试兼容内容尽量多的家居情况，在参与设计的实体硬件尽量小的情况下去实现较为丰富的实际场景内容。

我设计的“**智能RGN客制化家居场景灯光**”系统实现了一下的内容：

- 使用“触摸开关”实现了对于普通“自然灯光”的开关控制；
- 切换6种颜色不同的氛围灯光模式；
- 打开或关闭点阵LED矩阵图案显式灯管，变换6种不同的氛围动态图案；
- 使用定时器功能设置灯光的自动关闭，并通过蜂鸣器的提示获得设置反馈；
- 通过手机连接灯光系统的蓝牙模块，用户直接操作APP的方式，实现以上全部的功能的无线控制。

下文的系统功能介绍会按照操作流程的方式依此介绍，通过关键功能点强调的叙述方式来概括系统中所有设置参与硬件与功能操作。

### 系统连接图

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled.png)

系统连接图包含了六种硬件设备的参与：**Arduino UNO、 TM7219 8x8点阵LED显示管、KY-006蜂鸣器、JDY-16蓝牙适配器、TTP223触摸开关、LED二级灯管**。

### 自然灯光

家庭灯光的本质工作还是离不开“自然灯光”的使用，因为“氛围场景灯”的功能并不能达到每个用户的日常使用的频率，如同他的名字一样，它的特色功能有它的特使使用场景，而此外它的必要功能熟悉还得延续它作为“家用照明灯光”的主要职能工作。

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%201.png)

系统实现中采用了了5组不同颜色的LED二级灯管，从左到右分为是蓝、红、绿、黄、白色的灯管（白色用于模拟“自然灯光”的场景模式），每组并接了7个二级灯管用于模拟实际家居灯具中真实照明灯组的排布。

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%202.png)

图中则为物理触摸开关的应用，物理触摸开关用于模拟实际家居场景中固定在墙体排线表面的实体交互开关。开关有true和false两个状态。这个开关式整个灯光系统电源的阀门，当灯光状态为true启动的情况下，才能够启用整个灯光系统包括自然灯光、氛围灯在内的所有功能。

虽然，仅通过实体的触摸开关只能够开关普通“自然灯光”的功能，更多的个性化定制功能需要使用下文中的手机APP蓝牙控制实现。

### 通过手机APP蓝牙连接灯光系统

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%203.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%204.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%205.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%206.png)

打开我专门为本次课题设计制作的Android客户端APP，在首页“发现设备”列表中寻找到灯光系统中蓝牙适配器的名字“JDY-16”，点击即可连接到灯光系统。
连接成功后，JDY-16蓝牙适配器的指示灯管停止闪烁，表示设备以连接。此时APP的显式状体与实际的灯光状态一致，及灯光关闭，个性化功能为不可用状态

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%207.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%208.png)

这时点击APP的开关即可触发灯光系统的“自然灯光”，同时激活APP系统中的个性化控制（包括“氛围灯”、“定时器”、“图案点阵LED”功能）。
若此时要断开与灯光系统的连接，可以直接点击灯光控制页的左上角的返回按键，跳回首页“发现”设备页后，实际灯光系统的蓝牙适配器只是灯光继续周期性闪烁，即表示蓝牙已断开。如果此时灯管还为关闭，则蓝牙断开后灯管也不会自动关闭，这时可以直接触发物理触摸开关强制关闭灯光系统。

### 开启氛围灯

课题的灯光系统设计里设计的氛围灯一共有六种，这其中包括五种不同颜色的氛围灯以及一款跑马灯。

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%209.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2010.png)

**各个效果如下：**

选择氛围灯 - 蓝色

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2011.png)

选择氛围灯 - 红色

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2012.png)

选择氛围灯 - 绿色

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2013.png)

选择氛围灯 - 黄色

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2014.png)

此时在APP上手动关闭“氛围灯”的启用切换按钮，这时灯光系统无论是处于什么状态的“氛围灯”，都会在关闭后切换回“自然灯光”。

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2015.png)

### 启用点阵图案

点阵图形由一块型号为TM7219的8x8点阵LED显式灯管提供，与“氛围灯”个性化功能相同，它也属于“氛围制造”家居场景制造属性的一种，并且也需要在启动灯光系统电源后手动点击可用开关后启动。（当点击启用后，LED矩阵立刻就会显式默认的点阵图案）

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2016.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2017.png)

灯光系统的氛围图案点整提供了6种不同的图案，如下图：

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2018.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2019.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2020.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2021.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2022.png)

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2023.png)

在默认启动的情况下，LED灯管图案点整采用的是第一种“猫咪”的图案显式。它们会以“强光两闪、暗光两闪、间歇一秒”的模式周期性循环显示。
除此之外还有一种“跑马灯”的模式，以每种颜色显示100ms的速度循环切换五种不同的颜色，用于模拟一些节奏十分欢快的氛围家居氛围环境，例如舞厅、KTV灯灯光模拟。

### 定时关闭

时关闭是一项非常实用性的日常功能，用户能够通过手机APP直接设置灯光的自动关闭，计时从用户按下时间选择的选项那一刻开始

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2024.png)

计时分为了四个挡位，为了便于实现，我将课题实际作品的倒计时时间大大缩短了，分别为“15秒”、“30秒”、“1分05秒”、“1分30秒”。对应了实际的家居场景可以是15分钟、30分钟等等。

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2025.png)

当点击定时挡位后，灯光系统会立刻收到定时信号，系统中型号为KY-006的蜂鸣器会发出短促的提示音，表示计时开始。知道计时结束，灯管电源关闭。

![Untitled](SmartLightBLE%2077735f8e6b2c4a74822352712fd0e785/Untitled%2026.png)

若灯管系统已近进入了“定时关闭”计时，此时在APP上关闭“计时器”的可用切换按键，这时手机蓝牙会发送信号到灯管系统，可以强制打断计时，灯管正常继续运行，定时关闭取消。
